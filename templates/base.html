<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}E-commerce ROI Calculator{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600&family=Montserrat:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/corporate-black.css') }}" rel="stylesheet">
    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <button class="btn btn-link text-white sidebar-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <a class="navbar-brand ms-3" href="/">
                <i class="fas fa-calculator me-2"></i>
                E-commerce ROI Calculator
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    <i class="fas fa-info-circle me-2"></i>Chilean Market Focused
                </span>
            </div>
        </div>
    </nav>

    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h5><i class="fas fa-th-large me-2"></i>Navigation</h5>
        </div>
        
        <!-- Main Calculator -->
        <div class="sidebar-section">
            <h6 class="sidebar-section-title">Calculator</h6>
            <a href="/" class="sidebar-link {% if request.endpoint == 'index' %}active{% endif %}">
                <i class="fas fa-calculator"></i>
                <span>ROI Calculator</span>
            </a>
        </div>

        <!-- Analysis Tools -->
        <div class="sidebar-section">
            <h6 class="sidebar-section-title">Analysis Tools</h6>
            <a href="/compare" class="sidebar-link {% if request.endpoint == 'compare' %}active{% endif %}">
                <i class="fas fa-balance-scale"></i>
                <span>Compare Scenarios</span>
            </a>
            <a href="/whatif" class="sidebar-link {% if request.endpoint == 'whatif' %}active{% endif %}">
                <i class="fas fa-sliders-h"></i>
                <span>What-If Analysis</span>
            </a>
            <a href="/sensitivity" class="sidebar-link {% if request.endpoint == 'sensitivity' %}active{% endif %}">
                <i class="fas fa-chart-area"></i>
                <span>Sensitivity Analysis</span>
            </a>
            <a href="/breakeven" class="sidebar-link {% if request.endpoint == 'breakeven' %}active{% endif %}">
                <i class="fas fa-crosshairs"></i>
                <span>Break-Even Analysis</span>
            </a>
            <a href="/market-insights" class="sidebar-link {% if request.endpoint == 'market_insights' %}active{% endif %}">
                <i class="fas fa-chart-line"></i>
                <span>Market Insights</span>
            </a>
        </div>

        <!-- Management -->
        <div class="sidebar-section">
            <h6 class="sidebar-section-title">Management</h6>
            <a href="/history" class="sidebar-link {% if request.endpoint == 'history' %}active{% endif %}">
                <i class="fas fa-history"></i>
                <span>History</span>
            </a>
            <a href="/templates" class="sidebar-link {% if request.endpoint == 'templates' %}active{% endif %}">
                <i class="fas fa-layer-group"></i>
                <span>Templates</span>
            </a>
            <a href="/batch" class="sidebar-link {% if request.endpoint == 'batch' %}active{% endif %}">
                <i class="fas fa-tasks"></i>
                <span>Batch Processing</span>
            </a>
            <a href="/versions" class="sidebar-link {% if request.endpoint == 'versions' %}active{% endif %}">
                <i class="fas fa-code-branch"></i>
                <span>Version Control</span>
            </a>
        </div>

        <!-- Export & Reports -->
        <div class="sidebar-section">
            <h6 class="sidebar-section-title">Export & Reports</h6>
            <a href="/proposal" class="sidebar-link {% if request.endpoint == 'proposal_generator' %}active{% endif %}">
                <i class="fas fa-file-contract"></i>
                <span>Generate Proposals</span>
            </a>
            <a href="/powerpoint" class="sidebar-link {% if request.endpoint == 'powerpoint_export' %}active{% endif %}">
                <i class="fab fa-microsoft"></i>
                <span>PowerPoint Export</span>
            </a>
        </div>

        <!-- Settings -->
        <div class="sidebar-section">
            <h6 class="sidebar-section-title">Settings</h6>
            <a href="/currency-tax-config" class="sidebar-link {% if request.endpoint == 'currency_tax_config' %}active{% endif %}">
                <i class="fas fa-globe-americas"></i>
                <span>Currency & Tax</span>
            </a>
            <a href="/optimize" class="sidebar-link {% if request.endpoint == 'cost_optimizer' %}active{% endif %}">
                <i class="fas fa-magic"></i>
                <span>Cost Optimizer</span>
            </a>
        </div>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
            <small class="text-muted">
                <i class="fas fa-info-circle me-1"></i>
                Version 2.0.0
            </small>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content" id="mainContent">
        <div class="container-fluid">
            {% block content %}{% endblock %}
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Loader Utilities - Must load before other scripts -->
    <script src="{{ url_for('static', filename='js/loader-utils.js') }}"></script>
    <script>
        // Sidebar toggle functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            
            // Save preference
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        }

        // Load sidebar state on page load
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (sidebarCollapsed) {
                document.getElementById('sidebar').classList.add('collapsed');
                document.getElementById('mainContent').classList.add('expanded');
            }
        });

        // Handle responsive sidebar
        if (window.innerWidth < 768) {
            document.getElementById('sidebar').classList.add('collapsed');
            document.getElementById('mainContent').classList.add('expanded');
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>